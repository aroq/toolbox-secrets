tasks:
  git-secret:
    parameters:
    - name: secret_file
      type: string
    tasks:
      hide:
        steps:
        - task: core.exec
          arguments:
            title: "Git secret :: Hide secret"
            cmd: |
              git secret hide {{ .secret_file }}
      reveal:
        steps:
        - task: core.exec
          arguments:
            title: "Git secret :: Reveal secret"
            cmd: |
              git secret reveal -f {{ .secret_file }}
      delete:
        steps:
        - task: core.exec
          arguments:
            title: "Git secret :: Remove secret file"
            cmd: |
              rm {{ .secret_file }}

  gpg:
    bindParamsFromEnv: true
    tasks:
      import_key:
        parameters:
        - name: gpg_key_file
          type: string
        steps:
        - task: core.exec
          arguments:
            title: "GPG :: Import key"
            cmd: |
              gpg --batch --import {{ .gpg_key_file }}

      symmetric:
        parameters:
        - name: TOOLBOX_GPG_SECRET_PASSPHRASE
          type: string
        tasks:
          encrypt:
            parameters:
            - name: input
              type: string
            - name: output
              type: string
            steps:
            - task: core.exec
              arguments:
                title: "GPG :: Symmetric :: Encrypt file"
                cmd: |
                  gpg --symmetric --cipher-algo AES256 {{ .input }}

          decrypt:
            parameters:
            - name: input
              type: string
            - name: output
              type: string
            steps:
            - task: core.exec
              arguments:
                title: "GPG :: Symmetric :: Decrypt file"
                cmd: |
                  gpg --quiet --batch --yes --decrypt --passphrase="{{ .TOOLBOX_GPG_SECRET_PASSPHRASE }}" \
                    --output {{ .output }} {{ .input }};



